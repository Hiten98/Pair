<!DOCTYPE html>
    <!--TODO @Darwin clean up and organize code
        TODO @Darwin move functions to appropriate place
        TODO @Darwin database security
        TODO @Darwin make separate javascript files-->
<html>
  
  <!-- Necessary imports for firbase -->
  <script src="https://www.gstatic.com/firebasejs/4.9.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/4.9.0/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/4.9.1/firebase.js"></script>
  <script src="https://www.gstatic.com/firebasejs/4.9.0/firebase-auth.js"></script>

  <script>

    //All functions

    function createCompany(companyName, listOfLocations = "novalue", listOfEmployees = "novalue") {
      companyRef.update({
        [companyName]: "novalue"
      });
      var pin = Math.floor(Math.random() * 9000) + 1000;
      companyRef.child(companyName).update({
        "pin": pin,
        "listOfLocations": listOfLocations,
        "listOfEmployees": listOfEmployees
      });
    }

    function updateCompany(companyName, locations, employees) {
      var companyLocationRef = companyRef.child(companyName).child('listOfLocations');
      var listOfLocations = new Array();
      companyLocationRef.once("value").then(function(snapshot) {
        snapshot.forEach(function(childSnapshot) {
          var item = childSnapshot.val();
          listOfLocations.push(item);
        });
      });

      var companyEmployeeRef = companyRef.child(companyName).child('listOfEmployees');
      var listOfEmployees = new Array();
      companyEmployeeRef.once("value").then(function(snapshot) {
        snapshot.forEach(function(childSnapshot) {
          var item = childSnapshot.val()
          listOfEmployees.push(item);
        });
      });

      var newLocations = listOfLocations.concat(locations);
      var newEmployees = listOfEmployees.concat(employees);
      document.write(listOfEmployees.length);

      companyRef.child(companyName).update({
        "listOfLocations": newLocations,
        "listOfEmployees": newEmployees
      });
    };

    function createIntern(name, email, location) {
      internRef.update({
        [name]:"novalue"
      })//set?
      internRef.child(name).update({
        "email": email,
        "location": location
      });
    }





    //Initialize Firebase
    const config = {
      apiKey: "AIzaSyCpow5onc7CzR9ekowLsK_VA_UbK1FnWoM",
      authDomain: "pair-ab7d0.firebaseapp.com",
      databaseURL: "https://pair-ab7d0.firebaseio.com",
      projectId: "pair-ab7d0",
      storageBucket: "pair-ab7d0.appspot.com",
      messagingSenderId: "553932382090"
    };

    //Setup references to database
    var defaultApp = firebase.initializeApp(config);
    var ref = firebase.database().ref();

    //Setup references to Object headers
    var companyRef = ref.child("Company");
    var internRef = ref.child("User/Interns");


    createCompany("Mind Readers Inc", ["Place1", "Drace1", "Trace1"], ["P1", "P2"]);
    //createCompany("Telefrags", ["apple", "pear", "grape"]);
    updateCompany("Mind Readers Inc", ["France", "Trance", "Drance"], ["Person", "Persona"]);

    //createIntern("Andrew", "bass1purduedu", "Hawaii");
    //createIntern("Mihir", "tiwar@purdue.d", "NeYrok");

    // Code to retreive company locations
    

    


  </script>

</html>